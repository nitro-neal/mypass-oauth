"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _CognitiveFaceService = _interopRequireDefault(require("./CognitiveFaceService.js"));
var _StringUtil = _interopRequireDefault(require("../util/StringUtil.js"));
var _path = _interopRequireDefault(require("path"));
var _express = require("express");

describe("CognitiveFaceService", () => {
  it("detects faces in the image", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const imageUrl =
    'https://upload.wikimedia.org/wikipedia/commons/3/37/Dagestani_man_and_woman.jpg';
    const response = yield _CognitiveFaceService.default.detectFromUrl(imageUrl);
    console.log(JSON.stringify(response));
    expect(response).toBeTruthy();
  }));

  it("detects faces in the image from data url", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    // console.log(__dirname); // /Users/adam/git/coa/multimodal-login/src/services
    // '/src/services/mocks/personOneFaceOne.txt'
    const imageUrl = yield _StringUtil.default.stringFromFile(_path.default.resolve("src", "services", "mocks", "personTwoFaceOne.txt"));
    // console.log(imageUrl);
    const response = yield _CognitiveFaceService.default.detectFromDataUrl(imageUrl);
    console.log(JSON.stringify(response));
    expect(response).toBeTruthy();
  }));

  it("verifies that two faces closely match", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const response = yield _CognitiveFaceService.default.verifyFaceToFace("deb8e7b5-d0e9-4ac1-99c4-3d4c4bc4b209", "1aab37d9-410a-48e1-afca-eb001105a97a");
    console.log(JSON.stringify(response));
    expect(response.isIdentical).toBeTruthy();
  }));

  it("verifies that two faces don't match", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const response = yield _CognitiveFaceService.default.verifyFaceToFace("deb8e7b5-d0e9-4ac1-99c4-3d4c4bc4b209", "87c8e88a-5a2f-48e6-be13-0045f98af6d1");
    console.log(JSON.stringify(response));
    expect(response.isIdentical).toBeFalsy();
  }));

  it("verifies a face to a username", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const base64Image = yield _StringUtil.default.stringFromFile(_path.default.resolve("src", "services", "mocks", "personTwoFaceThree.txt"));
    const detectionResponse = yield _CognitiveFaceService.default.detectFromDataUrl(base64Image);
    console.log(detectionResponse);
    const response = yield _CognitiveFaceService.default.verifyFaceToUsername(detectionResponse[0].faceId, 'becky');
    console.log(response);
    // { isIdentical: true, confidence: 0.96075 }
  }));

  // TODO: turning of until we get db working in unit tests.
  // it("registers a face to a username", async() => {
  //   const base64Image = await StringUtil.stringFromFile(path.resolve("src", "services", "mocks", "personTwoFaceOne.txt"));
  //   const response = await CognitiveFaceService.registerFaceToUsername(base64Image, 'becky');
  //   console.log(JSON.stringify(response));
  //   // e.g.     {"persistedFaceId":"759614cb-ed70-4da6-b0d7-a23485c7b4b6"}
  // }, 10000);

  it("verifies face to username", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const response = yield _CognitiveFaceService.default.verifyFaceToUsername('', 'test');
  }));

  it("gets a person group in account", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const response = yield _CognitiveFaceService.default.getPersonGroup('mypasstest2');
    console.log(JSON.stringify(response));
  }));

  it("lists person groups in account", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const response = yield _CognitiveFaceService.default.personGroupList();
    console.log(JSON.stringify(response));
  }), 10000);

  it("lists person groups persons in account", /*#__PURE__*/(0, _asyncToGenerator2.default)(function* () {
    const response = yield _CognitiveFaceService.default.personGroupPersonList('mypasstest');
    console.log(response);
  }), 10000);

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9Db2duaXRpdmVGYWNlU2VydmljZS50ZXN0LmpzIl0sIm5hbWVzIjpbImRlc2NyaWJlIiwiaXQiLCJpbWFnZVVybCIsInJlc3BvbnNlIiwiQ29nbml0aXZlRmFjZVNlcnZpY2UiLCJkZXRlY3RGcm9tVXJsIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJleHBlY3QiLCJ0b0JlVHJ1dGh5IiwiU3RyaW5nVXRpbCIsInN0cmluZ0Zyb21GaWxlIiwicGF0aCIsInJlc29sdmUiLCJkZXRlY3RGcm9tRGF0YVVybCIsInZlcmlmeUZhY2VUb0ZhY2UiLCJpc0lkZW50aWNhbCIsInRvQmVGYWxzeSIsImJhc2U2NEltYWdlIiwiZGV0ZWN0aW9uUmVzcG9uc2UiLCJ2ZXJpZnlGYWNlVG9Vc2VybmFtZSIsImZhY2VJZCIsImdldFBlcnNvbkdyb3VwIiwicGVyc29uR3JvdXBMaXN0IiwicGVyc29uR3JvdXBQZXJzb25MaXN0Il0sIm1hcHBpbmdzIjoic01BQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUFBLFFBQVEsQ0FBQyxzQkFBRCxFQUF5QixNQUFNO0FBQ3JDQyxFQUFBQSxFQUFFLENBQUMsNEJBQUQsK0NBQStCLGFBQVk7QUFDM0MsVUFBTUMsUUFBUTtBQUNkLHFGQURBO0FBRUEsVUFBTUMsUUFBUSxTQUFTQyw4QkFBcUJDLGFBQXJCLENBQW1DSCxRQUFuQyxDQUF2QjtBQUNBSSxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsSUFBSSxDQUFDQyxTQUFMLENBQWVOLFFBQWYsQ0FBWjtBQUNBTyxJQUFBQSxNQUFNLENBQUNQLFFBQUQsQ0FBTixDQUFpQlEsVUFBakI7QUFDRCxHQU5DLEVBQUY7O0FBUUFWLEVBQUFBLEVBQUUsQ0FBQywwQ0FBRCwrQ0FBNkMsYUFBWTtBQUN6RDtBQUNBO0FBQ0EsVUFBTUMsUUFBUSxTQUFTVSxvQkFBV0MsY0FBWCxDQUEwQkMsY0FBS0MsT0FBTCxDQUFhLEtBQWIsRUFBb0IsVUFBcEIs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SEMsR0FHQyxLQUhELENBQUY7O0FBS0QsQ0FuRU8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb2duaXRpdmVGYWNlU2VydmljZSBmcm9tIFwiLi9Db2duaXRpdmVGYWNlU2VydmljZS5qc1wiO1xuaW1wb3J0IFN0cmluZ1V0aWwgZnJvbSBcIi4uL3V0aWwvU3RyaW5nVXRpbC5qc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IHJlc3BvbnNlIH0gZnJvbSBcImV4cHJlc3NcIjtcblxuZGVzY3JpYmUoXCJDb2duaXRpdmVGYWNlU2VydmljZVwiLCAoKSA9PiB7XG4gIGl0KFwiZGV0ZWN0cyBmYWNlcyBpbiB0aGUgaW1hZ2VcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGltYWdlVXJsID1cbiAgICAnaHR0cHM6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy8zLzM3L0RhZ2VzdGFuaV9tYW5fYW5kX3dvbWFuLmpwZyc7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBDb2duaXRpdmVGYWNlU2VydmljZS5kZXRlY3RGcm9tVXJsKGltYWdlVXJsKTtcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpO1xuICAgIGV4cGVjdChyZXNwb25zZSkudG9CZVRydXRoeSgpO1xuICB9KTtcblxuICBpdChcImRldGVjdHMgZmFjZXMgaW4gdGhlIGltYWdlIGZyb20gZGF0YSB1cmxcIiwgYXN5bmMgKCkgPT4ge1xuICAgIC8vIGNvbnNvbGUubG9nKF9fZGlybmFtZSk7IC8vIC9Vc2Vycy9hZGFtL2dpdC9jb2EvbXVsdGltb2RhbC1sb2dpbi9zcmMvc2VydmljZXNcbiAgICAvLyAnL3NyYy9zZXJ2aWNlcy9tb2Nrcy9wZXJzb25PbmVGYWNlT25lLnR4dCdcbiAgICBjb25zdCBpbWFnZVVybCA9IGF3YWl0IFN0cmluZ1V0aWwuc3RyaW5nRnJvbUZpbGUocGF0aC5yZXNvbHZlKFwic3JjXCIsIFwic2VydmljZXNcIiwgXCJtb2Nrc1wiLCBcInBlcnNvblR3b0ZhY2VPbmUudHh0XCIpKTtcbiAgICAvLyBjb25zb2xlLmxvZyhpbWFnZVVybCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBDb2duaXRpdmVGYWNlU2VydmljZS5kZXRlY3RGcm9tRGF0YVVybChpbWFnZVVybCk7XG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKTtcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgaXQoXCJ2ZXJpZmllcyB0aGF0IHR3byBmYWNlcyBjbG9zZWx5IG1hdGNoXCIsIGFzeW5jKCkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQ29nbml0aXZlRmFjZVNlcnZpY2UudmVyaWZ5RmFjZVRvRmFjZShcImRlYjhlN2I1LWQwZTktNGFjMS05OWM0LTNkNGM0YmM0YjIwOVwiLCBcIjFhYWIzN2Q5LTQxMGEtNDhlMS1hZmNhLWViMDAxMTA1YTk3YVwiKTtcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpO1xuICAgIGV4cGVjdChyZXNwb25zZS5pc0lkZW50aWNhbCkudG9CZVRydXRoeSgpO1xuICB9KTtcblxuICBpdChcInZlcmlmaWVzIHRoYXQgdHdvIGZhY2VzIGRvbid0IG1hdGNoXCIsIGFzeW5jKCkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQ29nbml0aXZlRmFjZVNlcnZpY2UudmVyaWZ5RmFjZVRvRmFjZShcImRlYjhlN2I1LWQwZTktNGFjMS05OWM0LTNkNGM0YmM0YjIwOVwiLCBcIjg3YzhlODhhLTVhMmYtNDhlNi1iZTEzLTAwNDVmOThhZjZkMVwiKTtcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpO1xuICAgIGV4cGVjdChyZXNwb25zZS5pc0lkZW50aWNhbCkudG9CZUZhbHN5KCk7XG4gIH0pO1xuXG4gIGl0KFwidmVyaWZpZXMgYSBmYWNlIHRvIGEgdXNlcm5hbWVcIiwgYXN5bmMoKSA9PiB7XG4gICAgY29uc3QgYmFzZTY0SW1hZ2UgPSBhd2FpdCBTdHJpbmdVdGlsLnN0cmluZ0Zyb21GaWxlKHBhdGgucmVzb2x2ZShcInNyY1wiLCBcInNlcnZpY2VzXCIsIFwibW9ja3NcIiwgXCJwZXJzb25Ud29GYWNlVGhyZWUudHh0XCIpKTtcbiAgICBjb25zdCBkZXRlY3Rpb25SZXNwb25zZSA9IGF3YWl0IENvZ25pdGl2ZUZhY2VTZXJ2aWNlLmRldGVjdEZyb21EYXRhVXJsKGJhc2U2NEltYWdlKTtcbiAgICBjb25zb2xlLmxvZyhkZXRlY3Rpb25SZXNwb25zZSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBDb2duaXRpdmVGYWNlU2VydmljZS52ZXJpZnlGYWNlVG9Vc2VybmFtZShkZXRlY3Rpb25SZXNwb25zZVswXS5mYWNlSWQsICdiZWNreScpO1xuICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAvLyB7IGlzSWRlbnRpY2FsOiB0cnVlLCBjb25maWRlbmNlOiAwLjk2MDc1IH1cbiAgfSk7XG5cbiAgLy8gVE9ETzogdHVybmluZyBvZiB1bnRpbCB3ZSBnZXQgZGIgd29ya2luZyBpbiB1bml0IHRlc3RzLlxuICAvLyBpdChcInJlZ2lzdGVycyBhIGZhY2UgdG8gYSB1c2VybmFtZVwiLCBhc3luYygpID0+IHtcbiAgLy8gICBjb25zdCBiYXNlNjRJbWFnZSA9IGF3YWl0IFN0cmluZ1V0aWwuc3RyaW5nRnJvbUZpbGUocGF0aC5yZXNvbHZlKFwic3JjXCIsIFwic2VydmljZXNcIiwgXCJtb2Nrc1wiLCBcInBlcnNvblR3b0ZhY2VPbmUudHh0XCIpKTtcbiAgLy8gICBjb25zdCByZXNwb25zZSA9IGF3YWl0IENvZ25pdGl2ZUZhY2VTZXJ2aWNlLnJlZ2lzdGVyRmFjZVRvVXNlcm5hbWUoYmFzZTY0SW1hZ2UsICdiZWNreScpO1xuICAvLyAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSk7XG4gIC8vICAgLy8gZS5nLiAgICAge1wicGVyc2lzdGVkRmFjZUlkXCI6XCI3NTk2MTRjYi1lZDcwLTRkYTYtYjBkNy1hMjM0ODVjN2I0YjZcIn1cbiAgLy8gfSwgMTAwMDApO1xuXG4gIGl0KFwidmVyaWZpZXMgZmFjZSB0byB1c2VybmFtZVwiLCBhc3luYygpID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IENvZ25pdGl2ZUZhY2VTZXJ2aWNlLnZlcmlmeUZhY2VUb1VzZXJuYW1lKCcnLCAndGVzdCcpO1xuICB9KTtcblxuICBpdChcImdldHMgYSBwZXJzb24gZ3JvdXAgaW4gYWNjb3VudFwiLCBhc3luYygpID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IENvZ25pdGl2ZUZhY2VTZXJ2aWNlLmdldFBlcnNvbkdyb3VwKCdteXBhc3N0ZXN0MicpO1xuICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSk7XG4gIH0pO1xuXG4gIGl0KFwibGlzdHMgcGVyc29uIGdyb3VwcyBpbiBhY2NvdW50XCIsIGFzeW5jKCkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQ29nbml0aXZlRmFjZVNlcnZpY2UucGVyc29uR3JvdXBMaXN0KCk7XG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKTtcbiAgfSwgMTAwMDApO1xuXG4gIGl0KFwibGlzdHMgcGVyc29uIGdyb3VwcyBwZXJzb25zIGluIGFjY291bnRcIiwgYXN5bmMoKSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBDb2duaXRpdmVGYWNlU2VydmljZS5wZXJzb25Hcm91cFBlcnNvbkxpc3QoJ215cGFzc3Rlc3QnKTtcbiAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gIH0sIDEwMDAwKTtcblxufSk7XG4iXX0=